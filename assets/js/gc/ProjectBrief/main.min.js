/*! Groovecrowd - v0.0.1 - 2012-07-05
* http://groovecrowd.com
* Includes: main.js
* Copyright (c) 2012 Jarad DeLorenzo; */
(function(a,b,c){function f(a,c,d){console.log("fileQueueError: "+d);try{var e=b("#file-upload-template").html(),f=Handlebars.compile(e);if(c===SWFUpload.errorCode_QUEUE_LIMIT_EXCEEDED)var g="You have attempted to queue too many files.";switch(c){case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:var h="zerobyte.gif";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:var i=f({percentage:"0",message:"Sorry, that file is too big!",messagetype:"alert-error"});b("#divFileProgressContainer").html(i);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:break;default:console.log("SWFUpload error")}}catch(j){this.debug(j)}}function g(a,b){console.log("fileDialogComplete: "+b);try{b>0&&this.startUpload()}catch(c){this.debug(c)}}function h(a,b){console.log("uploadProgress: "+b);try{var c=Math.ceil(b/a.size*100),d=new n(a,this.customSettings.upload_target);d.setProgress(100),c===100?(d.setStatus("Creating thumbnail..."),d.toggleCancel(!1,this)):(d.setStatus("Uploading "+a.name+"..."),d.toggleCancel(!0,this))}catch(e){this.debug(e)}}function i(a,b){console.log("uploadSuccess");try{var c=new n(a,this.customSettings.upload_target),d=JSON.parse(b);d.OK===1?(l(d.data.uri,d.data.thumb,d.data.id),c.setStatus("Your file is uploaded!"),c.toggleCancel(!1)):c.setError()}catch(e){this.debug(e)}}function j(a){}function k(a,b,c){console.log("uploadError: "+c);var d="error.gif",e;try{switch(b){case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:try{e=new n(a,this.customSettings.upload_target),e.setCancelled(),e.setStatus("Cancelled"),e.toggleCancel(!1)}catch(f){this.debug(f)}break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:try{e=new n(a,this.customSettings.upload_target),e.setCancelled(),e.setStatus("Stopped"),e.toggleCancel(!0)}catch(g){this.debug(g)}break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:d="uploadlimit.gif";break;default:console.log("SWFUpload error")}}catch(h){this.debug(h)}}function l(a,c,d){var e=b("#asset-thumbnail-template").html(),f=Handlebars.compile(e),g={id:d,uri:a,thumbUri:c},h=f(g),i=b(h),j=b(i).find("img")[0];b("#media-container div.alert").css("display","none"),b("#thumbnails").append(i);if(j.filters)try{j.filters.item("DXImageTransform.Microsoft.Alpha").opacity=0}catch(k){j.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}else j.style.opacity=0;j.onload=function(){m(j,0),b(".yoxview").yoxview({skin:"top_menu",backgroundColor:"#ffffff"})}}function m(a,b){var c=5,d=30;if(b<100){b+=c,b>100&&(b=100);if(a.filters)try{a.filters.item("DXImageTransform.Microsoft.Alpha").opacity=b}catch(e){a.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+b+")"}else a.style.opacity=b/100}b<100&&setTimeout(function(){m(a,b)},d)}function n(a,c){var d=b("#file-upload-template").html();this.template=Handlebars.compile(d);var e={percentage:"100",message:"Your file is <strong>Uploading...</strong>",messagetype:"alert-info"},f=this.template(e);b("#divFileProgressContainer").html(f),this.fileProgressID="divFileProgress"}var d="/img/",e=b("form[id^='project']").attr("id").split("-")[1];a.onRemoveTag=function(a){b.post(Routing.generate("project_remove_tag",{id:e,tag:a}))},a.initSWFUpload=function(){console.log("init swfupload: "+Routing.generate("asset_upload",{id:e})+"?"+b("#session_name").val()+"="+b("#session_id").val()),a.swfu=new SWFUpload({upload_url:Routing.generate("asset_upload",{id:e})+"?"+b("#session_name").val()+"="+b("#session_id").val(),file_size_limit:"1000 MB",file_types:"*.jpg; *.jpeg, *.png; *.gif; *.avi; *.mp4; *.m4v; *.mpg; *.mpeg",file_types_description:"Images and Videos",file_upload_limit:"0",file_queue_error_handler:f,file_dialog_complete_handler:g,upload_progress_handler:h,upload_error_handler:k,upload_success_handler:i,upload_complete_handler:j,button_image_url:d+"upload-btn.png",button_placeholder_id:"spanButtonPlaceholder",button_width:191,button_height:34,flash_url:"/swfupload.swf",custom_settings:{upload_target:"divFileProgressContainer"},debug:!1})},a.addRealImage=function(a,b,c){l(a,b,c)},n.prototype.setProgress=function(a){var c=this.template({percentage:a,message:"Your file is <strong>Uploading...</strong>",messagetype:"alert-info"});b("#divFileProgressContainer").html(c)},n.prototype.setComplete=function(){var a=this.template({percentage:100,message:"Your file is <strong>Uploaded!</strong>",messagetype:"alert-success"});b("#divFileProgressContainer").html(a).find("div.progress").removeClass("active"),setTimeout(function(){b("#divFileProgress").fadeOut()},2e3)},n.prototype.setError=function(){console.log("in error setter");var a=this.template({percentage:0,message:"<strong>Oops!</strong> Something went wrong =(",messagetype:"alert-error"});b("#divFileProgressContainer").html(a).find("div.progress").removeClass("active"),setTimeout(function(){b("#divFileProgress").fadeOut()},2e3)},n.prototype.setCancelled=function(){var a=this.template({percentage:0,message:"Your file upload was <strong>Cancelled</strong>",messagetype:""});b("#divFileProgressContainer").html(a)},n.prototype.setStatus=function(a){b("#file-upload-message").html(a)},n.prototype.toggleCancel=function(a,c){var d=a?"visible":"hidden";b("#divFileProgressContainer").css("visibility",d);if(c){var e=this.fileProgressID;b("#divFileProgressContainer").click(function(){return c.cancelUpload(e),!1})}}})(window.gc_project_brief=window.gc_project_brief||{},jQuery),$(document).ready(function(){$(document).ajaxError(function(a,b,c){console.log("Error requesting page "+c.url)}),$(".gc-control-label > label").addClass("control-label"),$(".tag-widget").tagsInput({width:"320px",placeholderColor:"#369BD7",onRemoveTag:gc_project_brief.onRemoveTag}),gc_project_brief.initSWFUpload(),$("#upload-btn").click(function(){return $.post(Routing.generate("asset_upload",{id:this.project_id})+"?"+$("#session_name").val()+"="+$("#session_id").val(),{url:$("#projectDescription_web_upload").val()},function(a){a.OK==="1"&&gc_project_brief.addRealImage(a.data.uri,a.data.thumb,a.data.id)},"json"),!1}),$(".thumbnail button.close").on("click",function(){var a=$(this).closest("li").attr("id").split("-")[1];return console.log(Routing.generate("asset_delete",{id:this.project_id,aid:a})),$.post(Routing.generate("asset_delete",{id:this.project_id,aid:a}),function(b){b.OK==="1"&&$("#asset-"+a).fadeOut("slow",function(){$(this).remove(),console.log($("#thumbnails").children().length),$("#thumbnails").children().length===0&&$("#media-container div.alert").css("display","block")})},"json"),!1})});